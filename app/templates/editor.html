<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Editor | Cassis-Verif</title>
        <meta name="description" content="" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="{{ url_for('static', path='tree-js/tree.min.js') }}"></script>
        <link rel="stylesheet" href="{{ url_for('static', path='tree-js/treejs.min.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', path='nice-select2/nice-select2.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', path='layout.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', path='scrollbar.css') }}" />
        <link rel="stylesheet" href="{{ url_for('static', path='editor.css') }}" />
    </head>
    <body>
        <header class="header">
            <h1>Cassis-Verif</h1>
            <nav>
                <a href="{{ url_for('home') }}">Home</a>
                <a href="{{ url_for('software_design_document') }}">Software-Design-Document</a>
                <a href="{{ url_for('doxygen') }}">Doxygen</a>
            </nav>
        </header>

        <main class="content">
            <!-- TODO: Use SplitJS -->
            <aside id="dir-tree">
                <!-- TODO: 2 Tabs (Files & Git) -->
                <div class="loading">
                    <div class="lds-dual-ring"></div>
                </div>
            </aside>
            <div class="editor-container">
                <div class="tab-list">
                    <div class="tab-fill"></div>
                </div>
                <div id="editor"></div>
                <div class="notification">TEST</div>
            </div>
            <div class="hints-container">
                <div class="toolbar">
                    <button id="btn-toggle-editor" class="button" onclick="toggle_editor()">Hide Editor</button>
                    <button id="btn-refresh-hints" class="button" {{ 'disabled' if selected_proof is none }} onclick="refresh_hints(true)">Refresh</button>
                    <select id="sel-proof" class="sel-proof" onchange="refresh_hints()">
                        {% for proof in proofs %}
                            <option 
                                value="{{ proof.name }}"
                                data-src="{{ proof.src }}"
                                data-harness="{{ proof.harness }}"
                                {{ 'selected' if proof.name == selected_proof.name }}
                            >{{ proof.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                    <div class="loading hidden">
                        <div class="lds-dual-ring"></div>
                    </div>
                    <div class="hints {{ 'hidden' if selected_proof is none }}">
                        <div class="hint-section ai"><h2>AI Description goes here</h2></div>
                        <div class="hint-section doxygen">
                            <h2>Callgraphs</h2>
                            <p>
                                TODO Description<br/>
                                <a target="_blank" rel="noreferrer" href="{{ url_for('get_doxygen_docs', file_path=callgraphs.file_href) }}">
                                    See Doxygen for more Info
                                </a>
                            </p>
                            <div class="callgraphs {{ 'hidden' if not callgraphs.callee or not callgraphs.caller }}">
                                <h4>Callee Graph</h4>
                                <a class="callee-link" target="_blank" href="{{ url_for('get_doxygen_docs', file_path=callgraphs.callee) }}">
                                    <img class="callee" src="{{ url_for('get_doxygen_docs', file_path=callgraphs.callee) }}" alt="Calleegraph" />
                                </a>
                                <h4>Caller Graph</h4>
                                <a class="caller-link" target="_blank" href="{{ url_for('get_doxygen_docs', file_path=callgraphs.caller) }}">
                                    <img class="caller" src="{{ url_for('get_doxygen_docs', file_path=callgraphs.caller) }}" alt="Callergraph" />
                                </a>
                            </div>
                            <div class="callgraph-error {{ 'hidden' if callgraphs.callee and callgraphs.caller }}">
                                <h4 class="alert danger margin-0">Callgraphs currently unavailable...</h4>
                            </div>
                        </div>
                        <div class="hint-section context"><h2>Function Context goes here</h2></div>
                        <div class="hint-section loop-unwinding">
                            <h2>Loop Unwinding</h2>
                            <p>
                                The following Loops were detected in the execution trace of the selected proof.
                                A corresponding <b>UNWINDSET</b> entry should be added to the proof makefile.<br/>
                                <a target="_blank" rel="noreferrer" href="https://model-checking.github.io/cbmc-training/cbmc/overview/loop-unwinding.html">
                                    See CBMC Tutorial for more Info
                                </a>
                            </p>
                            <ul class="table">
                                <li class="table-item">
                                    <h4 class="width-50">Name</h4>
                                    <h4 class="width-50">File/Line</h4>
                                </li>
                                {% if loops | length > 0 %} {% for _loop in loops %}
                                <li class="table-item">
                                    <div class="width-50">{{ _loop.name }}</div>
                                    <!-- TODO: add link/button to select corresponding file and scroll to function declaration -->
                                    <div class="width-50">{{ _loop.file }}:{{ _loop.line }}</div>
                                </li>
                                {% endfor %} {% else %}
                                <li class="table-item-empty"><h4>There are no loops in the selected proof...</h4></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                    <div>
                        <h3 class="no-proof-selected {{ 'hidden' if selected_proof is not none }}">Please select a proof to display hints</h3>
                    </div>
            </div>
        </div>

        <dialog id="contextmenu-file" class="contextmenu">
            <ul>
                <li><button data-path="" onclick="show_confirm_delete_entry_modal(event)">Delete File</button></li>
            </ul>
        </dialog>

        <dialog id="contextmenu-dir" class="contextmenu">
            <ul>
                <li><button data-path="" onclick="show_create_file_modal(event)">Create File</button></li>
                <li><button data-path="" onclick="show_create_dir_modal(event)">Create Folder</button></li>
                <li><button data-path="" onclick="show_confirm_delete_entry_modal(event)">Delete Folder</button></li>
            </ul>
        </dialog>

        <dialog id="modal-confirm-delete-entry" class="modal">
            <h2 class="modal-text">Delete Entry</h2>
            <p class="modal-text">Are you sure you want to delete the following file/folder?</p>
            <p class="modal-text code"><span id="entry-path" data-path=""></span></p>
            <form class="modal-form" method="dialog">
                <div class="modal-buttons">
                    <button class="button danger" onclick="delete_entry()">Confirm</button>
                    <button class="button" autofocus>Cancel</button>
                </div>
            </form>
        </dialog>

        <dialog id="modal-create-entry" class="modal">
            <h2 class="modal-text">Create <span id="entry-type" data-type=""></span></h2>
            <p class="modal-text alert danger hidden"></p>
            <form class="modal-form modal-form-25" method="dialog">
                <input id="entry-name" type="text" placeholder="Name" value="" autofocus />
                <div class="modal-buttons">
                    <button class="button success" onclick="create_entry(event)" data-parent="">Create</button>
                    <button class="button">Cancel</button>
                </div>
            </form>
        </dialog>

        <script src="{{ url_for('static', path='nice-select2/nice-select2.js') }}"></script>
        <script src="{{ url_for('static', path='monaco-editor/min/vs/loader.js') }}"></script>
        <script src="{{ url_for('static', path='editor.js') }}"></script>
    </body>
</html>
